<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Lemon - Meal Planning</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            sage: { 50: '#f6f7f4', 100: '#e8ebe3', 200: '#d4dac9', 300: '#b5c0a5', 400: '#94a47f', 500: '#778a62', 600: '#5d6e4d' },
            warm: { 50: '#fefcf9', 100: '#fdf8f0', 200: '#faf0df', 300: '#f5e4c8' },
            lemon: { 50: '#fefce8', 100: '#fef9c3', 400: '#fcd34d', 500: '#fbbf24' }
          }
        }
      }
    }
  </script>
  <style>
    * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; background: #fff; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .slide-up { animation: slide-up 0.3s ease-out; }
    @keyframes check-pop { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    .check-pop { animation: check-pop 0.25s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    // Icons
    const Icons = {
      X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
      Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
      Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>,
      Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" x2="19" y1="12" y2="12"/></svg>,
      ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m15 18-6-6 6-6"/></svg>,
      ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m9 18 6-6-6-6"/></svg>,
      Utensils: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
      PlusCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>,
      Camera: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
      Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
    };

    // All meals organized by category
    const MEAL_DATA = {
      'high-protein': {
        name: 'High Protein',
        color: 'text-red-500',
        meals: [
          { id: 'hp1', name: 'Grilled Chicken Bowl', calories: 450, protein: 42, carbs: 35, fat: 12, prepTime: 20, thumb: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300&q=80' },
          { id: 'hp2', name: 'Salmon & Quinoa', calories: 520, protein: 38, carbs: 42, fat: 18, prepTime: 25, thumb: 'https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=300&q=80' },
          { id: 'hp3', name: 'Greek Yogurt Parfait', calories: 320, protein: 24, carbs: 38, fat: 8, prepTime: 5, thumb: 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=300&q=80' },
          { id: 'hp4', name: 'Turkey Lettuce Wraps', calories: 280, protein: 32, carbs: 12, fat: 14, prepTime: 15, thumb: 'https://images.unsplash.com/photo-1529059356987-e022f10d3c22?w=300&q=80' },
          { id: 'hp5', name: 'Egg White Omelette', calories: 220, protein: 28, carbs: 8, fat: 10, prepTime: 10, thumb: 'https://images.unsplash.com/photo-1525351484163-7529414344d8?w=300&q=80' },
        ]
      },
      'low-calorie': {
        name: 'Low Calorie',
        color: 'text-green-500',
        meals: [
          { id: 'lc1', name: 'Buddha Bowl', calories: 350, protein: 15, carbs: 45, fat: 12, prepTime: 15, thumb: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&q=80' },
          { id: 'lc2', name: 'Zucchini Noodles', calories: 180, protein: 8, carbs: 18, fat: 8, prepTime: 20, thumb: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=300&q=80' },
          { id: 'lc3', name: 'Green Smoothie', calories: 150, protein: 5, carbs: 28, fat: 3, prepTime: 5, thumb: 'https://images.unsplash.com/photo-1502741224143-90386d7f8c82?w=300&q=80' },
          { id: 'lc4', name: 'Cauliflower Rice Stir Fry', calories: 220, protein: 12, carbs: 22, fat: 10, prepTime: 15, thumb: 'https://images.unsplash.com/photo-1543339308-43e59d6b73a6?w=300&q=80' },
          { id: 'lc5', name: 'Cucumber Avocado Salad', calories: 190, protein: 4, carbs: 12, fat: 16, prepTime: 10, thumb: 'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=300&q=80' },
        ]
      },
      'diabetes-friendly': {
        name: 'Diabetes Friendly',
        color: 'text-blue-500',
        meals: [
          { id: 'df1', name: 'Avocado Toast', calories: 320, protein: 12, carbs: 28, fat: 20, prepTime: 10, thumb: 'https://images.unsplash.com/photo-1541519227354-08fa5d50c44d?w=300&q=80' },
          { id: 'df2', name: 'Grilled Fish Tacos', calories: 380, protein: 28, carbs: 32, fat: 14, prepTime: 25, thumb: 'https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?w=300&q=80' },
          { id: 'df3', name: 'Lentil Soup', calories: 290, protein: 18, carbs: 38, fat: 6, prepTime: 30, thumb: 'https://images.unsplash.com/photo-1547592166-23ac45744acd?w=300&q=80' },
          { id: 'df4', name: 'Almond Butter Celery', calories: 180, protein: 6, carbs: 8, fat: 16, prepTime: 5, thumb: 'https://images.unsplash.com/photo-1473093295043-cdd812d0e601?w=300&q=80' },
        ]
      },
      'mediterranean': {
        name: 'Mediterranean',
        color: 'text-amber-500',
        meals: [
          { id: 'md1', name: 'Greek Salad', calories: 280, protein: 10, carbs: 18, fat: 20, prepTime: 10, thumb: 'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=300&q=80' },
          { id: 'md2', name: 'Hummus & Pita', calories: 320, protein: 12, carbs: 42, fat: 14, prepTime: 5, thumb: 'https://images.unsplash.com/photo-1481931098730-318b6f776db0?w=300&q=80' },
          { id: 'md3', name: 'Shakshuka', calories: 350, protein: 18, carbs: 22, fat: 22, prepTime: 20, thumb: 'https://images.unsplash.com/photo-1590412200988-a436970781fa?w=300&q=80' },
          { id: 'md4', name: 'Grilled Sea Bass', calories: 420, protein: 35, carbs: 12, fat: 26, prepTime: 25, thumb: 'https://images.unsplash.com/photo-1519708227418-c8fd9a32b7a2?w=300&q=80' },
        ]
      },
      'quick-easy': {
        name: 'Quick & Easy',
        color: 'text-purple-500',
        meals: [
          { id: 'qe1', name: 'Overnight Oats', calories: 350, protein: 14, carbs: 52, fat: 10, prepTime: 5, thumb: 'https://images.unsplash.com/photo-1517673400267-0251440c45dc?w=300&q=80' },
          { id: 'qe2', name: 'Caprese Sandwich', calories: 420, protein: 18, carbs: 38, fat: 22, prepTime: 10, thumb: 'https://images.unsplash.com/photo-1528735602780-2552fd46c7af?w=300&q=80' },
          { id: 'qe3', name: 'Sheet Pan Chicken', calories: 480, protein: 38, carbs: 28, fat: 24, prepTime: 15, thumb: 'https://images.unsplash.com/photo-1532550907401-a500c9a57435?w=300&q=80' },
          { id: 'qe4', name: 'Fruit & Nut Mix', calories: 200, protein: 6, carbs: 22, fat: 12, prepTime: 2, thumb: 'https://images.unsplash.com/photo-1478145046317-39f10e56b5e9?w=300&q=80' },
        ]
      },
    };

    // Most popular meals (curated)
    const MOST_POPULAR = [
      MEAL_DATA['high-protein'].meals[0],
      MEAL_DATA['mediterranean'].meals[2],
      MEAL_DATA['low-calorie'].meals[0],
      MEAL_DATA['quick-easy'].meals[2],
      MEAL_DATA['diabetes-friendly'].meals[1],
    ];

    // Meal Card Component
    function MealCard({ meal, isSelected, onToggle, showServings, servings, onServingsChange }) {
      return (
        <div className="flex-shrink-0 w-44">
          <div className="relative">
            <img
              src={meal.thumb}
              alt={meal.name}
              className="w-full h-36 object-cover rounded-2xl"
            />
            <button
              onClick={onToggle}
              className={`absolute top-2 right-2 w-8 h-8 rounded-full flex items-center justify-center transition-all ${
                isSelected
                  ? 'bg-sage-500 text-white'
                  : 'bg-white shadow-md text-gray-600 hover:bg-gray-50'
              }`}
            >
              {isSelected ? <Icons.Check /> : <Icons.Plus />}
            </button>
            {meal.isCustom && (
              <span className="absolute top-2 left-2 bg-lemon-400 text-xs font-medium px-2 py-0.5 rounded-full">My Recipe</span>
            )}
          </div>
          <p className="mt-2 text-sm font-medium text-gray-800 leading-tight">{meal.name}</p>

          {isSelected && showServings && (
            <div className="flex items-center gap-2 mt-2">
              <button
                onClick={() => onServingsChange(Math.max(1, servings - 1))}
                className="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-gray-500"
              >
                <Icons.Minus />
              </button>
              <span className="text-xs font-medium">{servings}</span>
              <button
                onClick={() => onServingsChange(servings + 1)}
                className="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-gray-500"
              >
                <Icons.Plus />
              </button>
            </div>
          )}
        </div>
      );
    }

    // Category Section Component
    function CategorySection({ categoryKey, category, selectedMeals, onToggleMeal, onSeeAll }) {
      return (
        <div className="mb-6">
          <div className="flex items-center justify-between px-5 mb-3">
            <h2 className="font-semibold text-gray-900">{category.name}</h2>
            <button onClick={onSeeAll} className="text-sage-500 text-sm font-medium">See All</button>
          </div>
          <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
            {category.meals.map(meal => (
              <MealCard
                key={meal.id}
                meal={meal}
                isSelected={!!selectedMeals[meal.id]}
                onToggle={() => onToggleMeal(meal, categoryKey)}
                showServings={false}
              />
            ))}
          </div>
        </div>
      );
    }

    // Saved Plan Card Component
    function SavedPlanCard({ plan, onLoad }) {
      return (
        <button
          onClick={onLoad}
          className="flex-shrink-0 w-32 text-left"
        >
          <div className="relative">
            <div className="w-full h-24 rounded-2xl overflow-hidden bg-gray-100">
              {plan.meals.length > 0 ? (
                <div className="grid grid-cols-2 h-full">
                  {plan.meals.slice(0, 4).map((meal, i) => (
                    <img key={i} src={meal.thumb} alt="" className="w-full h-full object-cover" />
                  ))}
                </div>
              ) : (
                <div className="w-full h-full flex items-center justify-center text-gray-400">
                  <Icons.Utensils />
                </div>
              )}
            </div>
            <div className="absolute bottom-1 right-1 bg-white/90 backdrop-blur rounded-full px-2 py-0.5">
              <span className="text-xs font-medium text-gray-700">{plan.meals.length} meals</span>
            </div>
          </div>
          <p className="mt-2 text-sm font-medium text-gray-800 truncate">{plan.name}</p>
          <p className="text-xs text-gray-500">{plan.date}</p>
        </button>
      );
    }

    // Macro Ring Component
    function MacroRing({ label, value, max, color }) {
      const percentage = Math.min((value / max) * 100, 100);
      const radius = 28;
      const circumference = 2 * Math.PI * radius;
      const strokeDashoffset = circumference - (percentage / 100) * circumference;

      return (
        <div className="flex flex-col items-center">
          <div className="relative w-16 h-16">
            <svg className="w-full h-full transform -rotate-90">
              <circle cx="32" cy="32" r={radius} fill="none" stroke="#e5e7eb" strokeWidth="4" />
              <circle
                cx="32" cy="32" r={radius} fill="none" stroke={color} strokeWidth="4"
                strokeDasharray={circumference} strokeDashoffset={strokeDashoffset}
                strokeLinecap="round"
              />
            </svg>
            <div className="absolute inset-0 flex items-center justify-center">
              <span className="text-sm font-semibold text-gray-800">{value}</span>
            </div>
          </div>
          <span className="text-xs text-gray-500 mt-1">{label}</span>
        </div>
      );
    }

    // Add Recipe Modal
    function AddRecipeModal({ onClose, onSave }) {
      const [name, setName] = useState('');
      const [calories, setCalories] = useState('');
      const [protein, setProtein] = useState('');
      const [carbs, setCarbs] = useState('');
      const [fat, setFat] = useState('');

      const handleSave = () => {
        if (!name.trim()) return;
        onSave({
          id: `custom-${Date.now()}`,
          name: name.trim(),
          calories: parseInt(calories) || 0,
          protein: parseInt(protein) || 0,
          carbs: parseInt(carbs) || 0,
          fat: parseInt(fat) || 0,
          prepTime: 0,
          thumb: 'https://images.unsplash.com/photo-1495521821757-a1efb6729352?w=300&q=80',
          isCustom: true,
        });
        onClose();
      };

      return (
        <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50" onClick={onClose}>
          <div className="bg-white w-full max-w-md rounded-t-3xl p-6 slide-up" onClick={e => e.stopPropagation()}>
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-semibold text-gray-800">Add Your Recipe</h2>
              <button onClick={onClose} className="text-gray-400"><Icons.X /></button>
            </div>

            {/* Photo placeholder */}
            <div className="w-full h-32 bg-gray-100 rounded-2xl flex flex-col items-center justify-center mb-4 border-2 border-dashed border-gray-300">
              <Icons.Camera />
              <span className="text-sm text-gray-500 mt-2">Add photo (optional)</span>
            </div>

            <div className="space-y-4">
              <div>
                <label className="text-sm font-medium text-gray-700">Recipe Name *</label>
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  placeholder="e.g., Grandma's Chicken Soup"
                  className="w-full mt-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-sage-500"
                />
              </div>

              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">Nutrition (optional)</label>
                <div className="grid grid-cols-4 gap-2">
                  <div>
                    <input
                      type="number"
                      value={calories}
                      onChange={(e) => setCalories(e.target.value)}
                      placeholder="0"
                      className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500"
                    />
                    <span className="text-xs text-gray-500 block text-center mt-1">Calories</span>
                  </div>
                  <div>
                    <input
                      type="number"
                      value={protein}
                      onChange={(e) => setProtein(e.target.value)}
                      placeholder="0"
                      className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500"
                    />
                    <span className="text-xs text-gray-500 block text-center mt-1">Protein</span>
                  </div>
                  <div>
                    <input
                      type="number"
                      value={carbs}
                      onChange={(e) => setCarbs(e.target.value)}
                      placeholder="0"
                      className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500"
                    />
                    <span className="text-xs text-gray-500 block text-center mt-1">Carbs</span>
                  </div>
                  <div>
                    <input
                      type="number"
                      value={fat}
                      onChange={(e) => setFat(e.target.value)}
                      placeholder="0"
                      className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500"
                    />
                    <span className="text-xs text-gray-500 block text-center mt-1">Fat</span>
                  </div>
                </div>
              </div>
            </div>

            <div className="flex gap-3 mt-6">
              <button
                onClick={onClose}
                className="flex-1 py-3 border border-gray-200 text-gray-600 font-medium rounded-xl"
              >
                Cancel
              </button>
              <button
                onClick={handleSave}
                disabled={!name.trim()}
                className="flex-1 py-3 bg-sage-500 text-white font-semibold rounded-xl disabled:opacity-50"
              >
                Add Recipe
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Main App
    function App() {
      const [view, setView] = useState('main'); // 'main', 'builder', 'category', 'plan'
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selectedMeals, setSelectedMeals] = useState({});
      const [customRecipes, setCustomRecipes] = useState([]);
      const [showAddRecipe, setShowAddRecipe] = useState(false);
      const [savedPlans, setSavedPlans] = useState([
        { id: 'sp1', name: 'Week 1 Plan', date: 'Jan 26', meals: [MEAL_DATA['high-protein'].meals[0], MEAL_DATA['low-calorie'].meals[0], MEAL_DATA['mediterranean'].meals[2]] },
        { id: 'sp2', name: 'Quick Meals', date: 'Jan 23', meals: [MEAL_DATA['quick-easy'].meals[0], MEAL_DATA['quick-easy'].meals[2]] },
        { id: 'sp3', name: 'Healthy Week', date: 'Jan 20', meals: [MEAL_DATA['low-calorie'].meals[0]] },
      ]);
      const [planName, setPlanName] = useState('');
      const [showSaveModal, setShowSaveModal] = useState(false);

      const toggleMeal = (meal, categoryKey) => {
        setSelectedMeals(prev => {
          if (prev[meal.id]) {
            const newMeals = { ...prev };
            delete newMeals[meal.id];
            return newMeals;
          } else {
            return { ...prev, [meal.id]: { ...meal, servings: 1, category: categoryKey } };
          }
        });
      };

      const updateServings = (mealId, servings) => {
        setSelectedMeals(prev => ({
          ...prev,
          [mealId]: { ...prev[mealId], servings }
        }));
      };

      const removeMeal = (mealId) => {
        setSelectedMeals(prev => {
          const newMeals = { ...prev };
          delete newMeals[mealId];
          return newMeals;
        });
      };

      const addCustomRecipe = (recipe) => {
        setCustomRecipes(prev => [recipe, ...prev]);
      };

      const savePlan = () => {
        if (!planName.trim()) return;
        const newPlan = {
          id: `plan-${Date.now()}`,
          name: planName,
          date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
          meals: Object.values(selectedMeals),
        };
        setSavedPlans(prev => [newPlan, ...prev]);
        setShowSaveModal(false);
        setPlanName('');
        setSelectedMeals({});
        setView('main');
      };

      const loadPlan = (plan) => {
        const mealsObj = {};
        plan.meals.forEach(meal => {
          mealsObj[meal.id] = { ...meal, servings: 1 };
        });
        setSelectedMeals(mealsObj);
        setView('plan');
      };

      // Calculate totals
      const selectedMealsArray = Object.values(selectedMeals);
      const totals = selectedMealsArray.reduce((acc, meal) => ({
        calories: acc.calories + (meal.calories * meal.servings),
        protein: acc.protein + (meal.protein * meal.servings),
        carbs: acc.carbs + (meal.carbs * meal.servings),
        fat: acc.fat + (meal.fat * meal.servings),
      }), { calories: 0, protein: 0, carbs: 0, fat: 0 });

      const totalMeals = selectedMealsArray.length;

      // Main Page
      if (view === 'main') {
        return (
          <div className={`min-h-screen bg-white max-w-md mx-auto ${totalMeals > 0 ? 'pb-28' : 'pb-8'}`}>
            {/* Header */}
            <div className="px-5 pt-14 pb-4 flex items-center justify-between">
              <h1 className="text-2xl font-bold text-gray-900">Meal Planning</h1>
              <button
                onClick={() => setShowAddRecipe(true)}
                className="text-sage-500 text-sm font-medium"
              >
                + Add Recipe
              </button>
            </div>

            {/* Recent Plans Section */}
            {savedPlans.length > 0 && (
              <div className="mb-6">
                <div className="flex items-center justify-between px-5 mb-3">
                  <h2 className="font-semibold text-gray-900">Recent</h2>
                  <button className="text-sage-500 text-sm font-medium">See All</button>
                </div>
                <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
                  {savedPlans.map(plan => (
                    <SavedPlanCard key={plan.id} plan={plan} onLoad={() => loadPlan(plan)} />
                  ))}
                </div>
              </div>
            )}

            {/* My Recipes Section */}
            {customRecipes.length > 0 && (
              <div className="mb-6">
                <div className="flex items-center justify-between px-5 mb-3">
                  <h2 className="font-semibold text-gray-900">My Recipes</h2>
                </div>
                <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
                  {customRecipes.map(meal => (
                    <MealCard
                      key={meal.id}
                      meal={meal}
                      isSelected={!!selectedMeals[meal.id]}
                      onToggle={() => toggleMeal(meal, 'custom')}
                      showServings={false}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* Most Popular Section */}
            <div className="mb-6">
              <div className="flex items-center justify-between px-5 mb-3">
                <h2 className="font-semibold text-gray-900">Most Popular</h2>
                <button className="text-sage-500 text-sm font-medium">See All</button>
              </div>
              <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
                {MOST_POPULAR.map(meal => (
                  <MealCard
                    key={meal.id}
                    meal={meal}
                    isSelected={!!selectedMeals[meal.id]}
                    onToggle={() => toggleMeal(meal, 'popular')}
                    showServings={false}
                  />
                ))}
              </div>
            </div>

            {/* Category Sections */}
            {Object.entries(MEAL_DATA).map(([key, category]) => (
              <CategorySection
                key={key}
                categoryKey={key}
                category={category}
                selectedMeals={selectedMeals}
                onToggleMeal={toggleMeal}
                onSeeAll={() => { setSelectedCategory(key); setView('category'); }}
              />
            ))}

            {/* Floating Save Plan Bar - appears when meals selected */}
            {totalMeals > 0 && (
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 max-w-md mx-auto slide-up">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="flex -space-x-2">
                      {selectedMealsArray.slice(0, 3).map((meal, i) => (
                        <img key={i} src={meal.thumb} alt="" className="w-10 h-10 rounded-full object-cover border-2 border-white" />
                      ))}
                    </div>
                    <span className="text-sm text-gray-600">{totalMeals} meal{totalMeals > 1 ? 's' : ''} selected</span>
                  </div>
                  <button
                    onClick={() => setView('plan')}
                    className="px-6 py-3 bg-sage-500 text-white font-semibold rounded-full"
                  >
                    Save plan
                  </button>
                </div>
              </div>
            )}

            {/* Add Recipe Modal */}
            {showAddRecipe && (
              <AddRecipeModal
                onClose={() => setShowAddRecipe(false)}
                onSave={addCustomRecipe}
              />
            )}
          </div>
        );
      }

      // See All Category View
      if (view === 'category' && selectedCategory) {
        const category = MEAL_DATA[selectedCategory];
        return (
          <div className="min-h-screen bg-white max-w-md mx-auto pb-32">
            {/* Header */}
            <div className="sticky top-0 bg-white border-b border-gray-100 px-5 pt-14 pb-4 z-10">
              <div className="flex items-center gap-3">
                <button onClick={() => setView('main')} className="text-gray-600">
                  <Icons.ChevronLeft />
                </button>
                <h1 className="text-xl font-semibold text-gray-900">{category.name}</h1>
              </div>
            </div>

            {/* Meals Grid */}
            <div className="px-5 py-4">
              <div className="grid grid-cols-2 gap-4">
                {category.meals.map(meal => (
                  <div key={meal.id}>
                    <MealCard
                      meal={meal}
                      isSelected={!!selectedMeals[meal.id]}
                      onToggle={() => toggleMeal(meal, selectedCategory)}
                      showServings={!!selectedMeals[meal.id]}
                      servings={selectedMeals[meal.id]?.servings || 1}
                      onServingsChange={(s) => updateServings(meal.id, s)}
                    />
                  </div>
                ))}
              </div>
            </div>

            {/* Bottom Bar */}
            {totalMeals > 0 && (
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 max-w-md mx-auto">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="flex -space-x-2">
                      {selectedMealsArray.slice(0, 3).map((meal, i) => (
                        <img key={i} src={meal.thumb} alt="" className="w-10 h-10 rounded-full object-cover border-2 border-white" />
                      ))}
                    </div>
                    <span className="text-sm text-gray-600">{totalMeals} meal{totalMeals > 1 ? 's' : ''}</span>
                  </div>
                  <button
                    onClick={() => setView('plan')}
                    className="px-6 py-3 bg-sage-500 text-white font-semibold rounded-full"
                  >
                    Save plan
                  </button>
                </div>
              </div>
            )}
          </div>
        );
      }

      // Builder View
      if (view === 'builder') {
        return (
          <div className="min-h-screen bg-white max-w-md mx-auto pb-32">
            {/* Header */}
            <div className="sticky top-0 bg-white px-5 pt-14 pb-4 z-10 border-b border-gray-100">
              <div className="flex items-center justify-between">
                <button onClick={() => setView('main')} className="text-gray-600">
                  <Icons.X />
                </button>
                <h1 className="text-lg font-semibold text-gray-900">Build a meal plan</h1>
                <button
                  onClick={() => setShowAddRecipe(true)}
                  className="text-sage-500 text-sm font-medium"
                >
                  + Add Recipe
                </button>
              </div>
            </div>

            {/* Macro Summary - shows when meals selected */}
            {totalMeals > 0 && (
              <div className="mx-5 mt-4 mb-6 p-4 bg-sage-50 rounded-2xl border border-sage-200">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="font-semibold text-gray-800">Daily Totals</h3>
                  <span className="text-sm text-sage-600">{totalMeals} meal{totalMeals > 1 ? 's' : ''}</span>
                </div>
                <div className="flex justify-around">
                  <MacroRing label="Calories" value={totals.calories} max={2000} color="#778a62" />
                  <MacroRing label="Protein" value={totals.protein} max={150} color="#ef4444" />
                  <MacroRing label="Carbs" value={totals.carbs} max={250} color="#f59e0b" />
                  <MacroRing label="Fat" value={totals.fat} max={80} color="#3b82f6" />
                </div>
              </div>
            )}

            {/* My Recipes */}
            {customRecipes.length > 0 && (
              <div className="mb-6">
                <div className="flex items-center justify-between px-5 mb-3">
                  <h2 className="font-semibold text-gray-900">My Recipes</h2>
                  <button className="text-sage-500 text-sm font-medium">See All</button>
                </div>
                <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
                  {customRecipes.map(meal => (
                    <MealCard
                      key={meal.id}
                      meal={meal}
                      isSelected={!!selectedMeals[meal.id]}
                      onToggle={() => toggleMeal(meal, 'custom')}
                      showServings={false}
                    />
                  ))}
                </div>
              </div>
            )}

            {/* Category Sections */}
            {Object.entries(MEAL_DATA).map(([key, category]) => (
              <CategorySection
                key={key}
                categoryKey={key}
                category={category}
                selectedMeals={selectedMeals}
                onToggleMeal={toggleMeal}
                onSeeAll={() => { setSelectedCategory(key); setView('category'); }}
              />
            ))}

            {/* Bottom Bar - Save Plan */}
            {totalMeals > 0 && (
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 max-w-md mx-auto slide-up">
                <div className="flex items-center justify-between">
                  <div className="flex -space-x-2">
                    {selectedMealsArray.slice(0, 4).map((meal, i) => (
                      <img key={i} src={meal.thumb} alt="" className="w-10 h-10 rounded-full object-cover border-2 border-white" />
                    ))}
                    {totalMeals > 4 && (
                      <div className="w-10 h-10 rounded-full bg-gray-100 border-2 border-white flex items-center justify-center text-xs text-gray-600">
                        +{totalMeals - 4}
                      </div>
                    )}
                  </div>
                  <button
                    onClick={() => setShowSaveModal(true)}
                    className="px-6 py-3 bg-sage-500 text-white font-semibold rounded-full"
                  >
                    Save my plan
                  </button>
                </div>
              </div>
            )}

            {/* Add Recipe Modal */}
            {showAddRecipe && (
              <AddRecipeModal
                onClose={() => setShowAddRecipe(false)}
                onSave={addCustomRecipe}
              />
            )}

            {/* Save Modal */}
            {showSaveModal && (
              <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50" onClick={() => setShowSaveModal(false)}>
                <div className="bg-white w-full max-w-md rounded-t-3xl p-6 slide-up" onClick={e => e.stopPropagation()}>
                  <h2 className="text-xl font-semibold text-gray-800 mb-4">Save Your Plan</h2>
                  <input
                    type="text"
                    placeholder="Plan name (e.g., My Week Plan)"
                    value={planName}
                    onChange={(e) => setPlanName(e.target.value)}
                    className="w-full px-4 py-3 border border-gray-200 rounded-xl text-gray-800 mb-4 focus:outline-none focus:border-sage-500"
                  />
                  <div className="flex gap-3">
                    <button
                      onClick={() => setShowSaveModal(false)}
                      className="flex-1 py-3 border border-gray-200 text-gray-600 font-medium rounded-xl"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={savePlan}
                      disabled={!planName.trim()}
                      className="flex-1 py-3 bg-sage-500 text-white font-semibold rounded-xl disabled:opacity-50"
                    >
                      Save
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      // Plan View
      if (view === 'plan') {
        return (
          <div className="min-h-screen bg-white max-w-md mx-auto pb-32">
            {/* Header */}
            <div className="sticky top-0 bg-white px-5 pt-14 pb-4 z-10">
              <div className="flex items-center gap-3">
                <button onClick={() => setView('main')} className="text-gray-600">
                  <Icons.ChevronLeft />
                </button>
                <h1 className="text-xl font-semibold text-gray-900">Your Plan</h1>
              </div>
            </div>

            {/* Macro Summary Card */}
            {totalMeals > 0 && (
              <div className="mx-5 mb-6 p-4 bg-sage-50 rounded-2xl border border-sage-200">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="font-semibold text-gray-800">Daily Totals</h3>
                  <span className="text-sm text-sage-600">{totalMeals} meal{totalMeals > 1 ? 's' : ''}</span>
                </div>
                <div className="flex justify-around">
                  <MacroRing label="Calories" value={totals.calories} max={2000} color="#778a62" />
                  <MacroRing label="Protein" value={totals.protein} max={150} color="#ef4444" />
                  <MacroRing label="Carbs" value={totals.carbs} max={250} color="#f59e0b" />
                  <MacroRing label="Fat" value={totals.fat} max={80} color="#3b82f6" />
                </div>
                <div className="mt-4 pt-4 border-t border-sage-200 grid grid-cols-4 text-center text-xs text-gray-500">
                  <span>Goal: 2000</span>
                  <span>Goal: 150g</span>
                  <span>Goal: 250g</span>
                  <span>Goal: 80g</span>
                </div>
              </div>
            )}

            {/* Selected Meals */}
            {totalMeals > 0 ? (
              <div className="px-5 mb-6">
                <h2 className="font-semibold text-gray-900 mb-3">Your Meals</h2>
                <div className="grid grid-cols-2 gap-4">
                  {selectedMealsArray.map(meal => (
                    <div key={meal.id} className="relative">
                      <img src={meal.thumb} alt={meal.name} className="w-full h-32 object-cover rounded-2xl" />
                      <button
                        onClick={() => removeMeal(meal.id)}
                        className="absolute top-2 right-2 w-7 h-7 bg-sage-500 text-white rounded-full flex items-center justify-center shadow-md"
                      >
                        <Icons.Check />
                      </button>
                      {meal.isCustom && (
                        <span className="absolute top-2 left-2 bg-lemon-400 text-xs font-medium px-2 py-0.5 rounded-full">My Recipe</span>
                      )}
                      <p className="mt-2 text-sm font-medium text-gray-800 leading-tight">{meal.name}</p>
                      <div className="flex items-center gap-2 mt-1">
                        <button
                          onClick={() => updateServings(meal.id, Math.max(1, meal.servings - 1))}
                          className="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-gray-500"
                        >
                          <Icons.Minus />
                        </button>
                        <span className="text-xs font-medium">{meal.servings} serving{meal.servings > 1 ? 's' : ''}</span>
                        <button
                          onClick={() => updateServings(meal.id, meal.servings + 1)}
                          className="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-gray-500"
                        >
                          <Icons.Plus />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ) : (
              <div className="mx-5 mb-6 p-8 bg-gray-50 rounded-2xl text-center">
                <p className="text-gray-500">No meals selected yet</p>
                <button
                  onClick={() => setView('main')}
                  className="mt-3 px-4 py-2 bg-sage-500 text-white text-sm font-medium rounded-lg"
                >
                  Add Meals
                </button>
              </div>
            )}

            {/* Bottom Actions */}
            {totalMeals > 0 && (
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 max-w-md mx-auto">
                <div className="flex gap-3">
                  <button
                    onClick={() => setView('main')}
                    className="flex-1 py-3 border border-gray-200 text-gray-700 font-medium rounded-full"
                  >
                    Add More
                  </button>
                  <button
                    onClick={() => setShowSaveModal(true)}
                    className="flex-1 py-3 bg-sage-500 text-white font-semibold rounded-full"
                  >
                    Save Plan
                  </button>
                </div>
              </div>
            )}

            {/* Save Modal */}
            {showSaveModal && (
              <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50" onClick={() => setShowSaveModal(false)}>
                <div className="bg-white w-full max-w-md rounded-t-3xl p-6 slide-up" onClick={e => e.stopPropagation()}>
                  <h2 className="text-xl font-semibold text-gray-800 mb-4">Save Your Plan</h2>
                  <input
                    type="text"
                    placeholder="Plan name (e.g., My Week Plan)"
                    value={planName}
                    onChange={(e) => setPlanName(e.target.value)}
                    className="w-full px-4 py-3 border border-gray-200 rounded-xl text-gray-800 mb-4 focus:outline-none focus:border-sage-500"
                  />
                  <div className="flex gap-3">
                    <button
                      onClick={() => setShowSaveModal(false)}
                      className="flex-1 py-3 border border-gray-200 text-gray-600 font-medium rounded-xl"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={savePlan}
                      disabled={!planName.trim()}
                      className="flex-1 py-3 bg-sage-500 text-white font-semibold rounded-xl disabled:opacity-50"
                    >
                      Save
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      return null;
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
