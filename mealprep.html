<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Lemon - Meal Planning</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            sage: { 50: '#f6f7f4', 100: '#e8ebe3', 200: '#d4dac9', 300: '#b5c0a5', 400: '#94a47f', 500: '#778a62', 600: '#5d6e4d' },
            warm: { 50: '#fefcf9', 100: '#fdf8f0', 200: '#faf0df', 300: '#f5e4c8' },
            lemon: { 50: '#fefce8', 100: '#fef9c3', 400: '#fcd34d', 500: '#fbbf24' }
          }
        }
      }
    }
  </script>
  <style>
    * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; background: #fff; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .slide-up { animation: slide-up 0.3s ease-out; }
    @keyframes check-pop { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    .check-pop { animation: check-pop 0.25s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    // Icons
    const Icons = {
      X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
      Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
      Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>,
      Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" x2="19" y1="12" y2="12"/></svg>,
      ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m15 18-6-6 6-6"/></svg>,
      ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m9 18 6-6-6-6"/></svg>,
      Utensils: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
      PlusCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>,
      Camera: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
      Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
      Share: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>,
      ShoppingCart: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
      Save: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
      List: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>,
    };

    // All meals organized by category with ingredients
    const MEAL_DATA = {
      'high-protein': {
        name: 'High Protein',
        color: 'text-red-500',
        meals: [
          {
            id: 'hp1', name: 'Grilled Chicken Bowl', calories: 450, protein: 42, carbs: 35, fat: 12, prepTime: 20,
            thumb: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300&q=80',
            ingredients: [
              { name: 'Chicken breast', amount: '6 oz', category: 'Protein' },
              { name: 'Brown rice', amount: '1 cup', category: 'Grains' },
              { name: 'Broccoli', amount: '1 cup', category: 'Vegetables' },
              { name: 'Olive oil', amount: '1 tbsp', category: 'Oils' },
              { name: 'Garlic', amount: '2 cloves', category: 'Produce' },
            ]
          },
          {
            id: 'hp2', name: 'Salmon & Quinoa', calories: 520, protein: 38, carbs: 42, fat: 18, prepTime: 25,
            thumb: 'https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=300&q=80',
            ingredients: [
              { name: 'Salmon fillet', amount: '5 oz', category: 'Protein' },
              { name: 'Quinoa', amount: '1 cup', category: 'Grains' },
              { name: 'Asparagus', amount: '6 spears', category: 'Vegetables' },
              { name: 'Lemon', amount: '1', category: 'Produce' },
              { name: 'Dill', amount: '2 tbsp', category: 'Herbs' },
            ]
          },
          {
            id: 'hp3', name: 'Greek Yogurt Parfait', calories: 320, protein: 24, carbs: 38, fat: 8, prepTime: 5,
            thumb: 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=300&q=80',
            ingredients: [
              { name: 'Greek yogurt', amount: '1.5 cups', category: 'Dairy' },
              { name: 'Granola', amount: '1/2 cup', category: 'Grains' },
              { name: 'Mixed berries', amount: '1 cup', category: 'Fruit' },
              { name: 'Honey', amount: '1 tbsp', category: 'Sweeteners' },
            ]
          },
          {
            id: 'hp4', name: 'Turkey Lettuce Wraps', calories: 280, protein: 32, carbs: 12, fat: 14, prepTime: 15,
            thumb: 'https://images.unsplash.com/photo-1529059356987-e022f10d3c22?w=300&q=80',
            ingredients: [
              { name: 'Ground turkey', amount: '6 oz', category: 'Protein' },
              { name: 'Butter lettuce', amount: '6 leaves', category: 'Vegetables' },
              { name: 'Water chestnuts', amount: '1/4 cup', category: 'Vegetables' },
              { name: 'Soy sauce', amount: '2 tbsp', category: 'Condiments' },
              { name: 'Ginger', amount: '1 tsp', category: 'Produce' },
            ]
          },
        ]
      },
      'low-calorie': {
        name: 'Low Calorie',
        color: 'text-green-500',
        meals: [
          {
            id: 'lc1', name: 'Buddha Bowl', calories: 350, protein: 15, carbs: 45, fat: 12, prepTime: 15,
            thumb: 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=300&q=80',
            ingredients: [
              { name: 'Chickpeas', amount: '1/2 cup', category: 'Protein' },
              { name: 'Sweet potato', amount: '1 medium', category: 'Vegetables' },
              { name: 'Kale', amount: '2 cups', category: 'Vegetables' },
              { name: 'Tahini', amount: '2 tbsp', category: 'Condiments' },
              { name: 'Red cabbage', amount: '1/2 cup', category: 'Vegetables' },
            ]
          },
          {
            id: 'lc2', name: 'Zucchini Noodles', calories: 180, protein: 8, carbs: 18, fat: 8, prepTime: 20,
            thumb: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=300&q=80',
            ingredients: [
              { name: 'Zucchini', amount: '2 medium', category: 'Vegetables' },
              { name: 'Cherry tomatoes', amount: '1 cup', category: 'Vegetables' },
              { name: 'Parmesan', amount: '2 tbsp', category: 'Dairy' },
              { name: 'Basil', amount: '1/4 cup', category: 'Herbs' },
              { name: 'Pine nuts', amount: '2 tbsp', category: 'Nuts' },
            ]
          },
          {
            id: 'lc3', name: 'Green Smoothie', calories: 150, protein: 5, carbs: 28, fat: 3, prepTime: 5,
            thumb: 'https://images.unsplash.com/photo-1502741224143-90386d7f8c82?w=300&q=80',
            ingredients: [
              { name: 'Spinach', amount: '2 cups', category: 'Vegetables' },
              { name: 'Banana', amount: '1', category: 'Fruit' },
              { name: 'Almond milk', amount: '1 cup', category: 'Dairy' },
              { name: 'Chia seeds', amount: '1 tbsp', category: 'Seeds' },
            ]
          },
        ]
      },
      'mediterranean': {
        name: 'Mediterranean',
        color: 'text-amber-500',
        meals: [
          {
            id: 'md1', name: 'Greek Salad', calories: 280, protein: 10, carbs: 18, fat: 20, prepTime: 10,
            thumb: 'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=300&q=80',
            ingredients: [
              { name: 'Cucumber', amount: '1 large', category: 'Vegetables' },
              { name: 'Tomatoes', amount: '2 medium', category: 'Vegetables' },
              { name: 'Feta cheese', amount: '3 oz', category: 'Dairy' },
              { name: 'Kalamata olives', amount: '1/4 cup', category: 'Vegetables' },
              { name: 'Red onion', amount: '1/4', category: 'Vegetables' },
              { name: 'Olive oil', amount: '2 tbsp', category: 'Oils' },
            ]
          },
          {
            id: 'md2', name: 'Hummus & Pita', calories: 320, protein: 12, carbs: 42, fat: 14, prepTime: 5,
            thumb: 'https://images.unsplash.com/photo-1481931098730-318b6f776db0?w=300&q=80',
            ingredients: [
              { name: 'Hummus', amount: '1/2 cup', category: 'Dips' },
              { name: 'Pita bread', amount: '2', category: 'Grains' },
              { name: 'Carrots', amount: '1 cup', category: 'Vegetables' },
              { name: 'Bell peppers', amount: '1', category: 'Vegetables' },
            ]
          },
          {
            id: 'md3', name: 'Shakshuka', calories: 350, protein: 18, carbs: 22, fat: 22, prepTime: 20,
            thumb: 'https://images.unsplash.com/photo-1590412200988-a436970781fa?w=300&q=80',
            ingredients: [
              { name: 'Eggs', amount: '3', category: 'Protein' },
              { name: 'Canned tomatoes', amount: '1 can', category: 'Canned' },
              { name: 'Bell pepper', amount: '1', category: 'Vegetables' },
              { name: 'Onion', amount: '1', category: 'Vegetables' },
              { name: 'Cumin', amount: '1 tsp', category: 'Spices' },
              { name: 'Paprika', amount: '1 tsp', category: 'Spices' },
            ]
          },
        ]
      },
      'quick-easy': {
        name: 'Quick & Easy',
        color: 'text-purple-500',
        meals: [
          {
            id: 'qe1', name: 'Overnight Oats', calories: 350, protein: 14, carbs: 52, fat: 10, prepTime: 5,
            thumb: 'https://images.unsplash.com/photo-1517673400267-0251440c45dc?w=300&q=80',
            ingredients: [
              { name: 'Rolled oats', amount: '1/2 cup', category: 'Grains' },
              { name: 'Almond milk', amount: '1/2 cup', category: 'Dairy' },
              { name: 'Greek yogurt', amount: '1/4 cup', category: 'Dairy' },
              { name: 'Maple syrup', amount: '1 tbsp', category: 'Sweeteners' },
              { name: 'Blueberries', amount: '1/2 cup', category: 'Fruit' },
            ]
          },
          {
            id: 'qe2', name: 'Caprese Sandwich', calories: 420, protein: 18, carbs: 38, fat: 22, prepTime: 10,
            thumb: 'https://images.unsplash.com/photo-1528735602780-2552fd46c7af?w=300&q=80',
            ingredients: [
              { name: 'Ciabatta bread', amount: '1 roll', category: 'Grains' },
              { name: 'Fresh mozzarella', amount: '4 oz', category: 'Dairy' },
              { name: 'Tomato', amount: '1 large', category: 'Vegetables' },
              { name: 'Basil leaves', amount: '6', category: 'Herbs' },
              { name: 'Balsamic glaze', amount: '1 tbsp', category: 'Condiments' },
            ]
          },
        ]
      },
    };

    // Most popular meals (curated)
    const MOST_POPULAR = [
      MEAL_DATA['high-protein'].meals[0],
      MEAL_DATA['mediterranean'].meals[2],
      MEAL_DATA['low-calorie'].meals[0],
      MEAL_DATA['quick-easy'].meals[0],
    ];

    // Macro Ring Component (smaller for recipe cards)
    function MacroRing({ label, value, color, size = 'normal' }) {
      const isSmall = size === 'small';
      const radius = isSmall ? 14 : 28;
      const svgSize = isSmall ? 36 : 64;
      const strokeWidth = isSmall ? 3 : 4;

      return (
        <div className="flex flex-col items-center">
          <div className={isSmall ? 'w-9 h-9' : 'w-16 h-16'} style={{ width: svgSize, height: svgSize }}>
            <svg className="w-full h-full transform -rotate-90">
              <circle cx={svgSize/2} cy={svgSize/2} r={radius} fill="none" stroke="#e5e7eb" strokeWidth={strokeWidth} />
              <circle
                cx={svgSize/2} cy={svgSize/2} r={radius} fill="none" stroke={color} strokeWidth={strokeWidth}
                strokeDasharray={2 * Math.PI * radius} strokeDashoffset={0}
                strokeLinecap="round"
              />
            </svg>
            <div className="absolute inset-0 flex items-center justify-center" style={{ position: 'relative', marginTop: isSmall ? -svgSize : -svgSize }}>
              <span className={`font-semibold text-gray-800 ${isSmall ? 'text-xs' : 'text-sm'}`}>{value}</span>
            </div>
          </div>
          <span className={`text-gray-500 ${isSmall ? 'text-[10px] mt-0' : 'text-xs mt-1'}`}>{label}</span>
        </div>
      );
    }

    // Meal Card Component
    function MealCard({ meal, isSelected, onToggle, showMacros = false }) {
      return (
        <div className="flex-shrink-0 w-44">
          <div className="relative">
            <img
              src={meal.thumb}
              alt={meal.name}
              className="w-full h-36 object-cover rounded-2xl"
            />
            <button
              onClick={onToggle}
              className={`absolute top-2 right-2 w-8 h-8 rounded-full flex items-center justify-center transition-all ${
                isSelected
                  ? 'bg-sage-500 text-white'
                  : 'bg-white shadow-md text-gray-600 hover:bg-gray-50'
              }`}
            >
              {isSelected ? <Icons.Check /> : <Icons.Plus />}
            </button>
            {meal.isCustom && (
              <span className="absolute top-2 left-2 bg-lemon-400 text-xs font-medium px-2 py-0.5 rounded-full">My Recipe</span>
            )}
          </div>
          <p className="mt-2 text-sm font-medium text-gray-800 leading-tight">{meal.name}</p>

          {/* Recipe-level macros */}
          {showMacros && (
            <div className="flex items-center gap-2 mt-2 text-xs text-gray-500">
              <span>{meal.calories} cal</span>
              <span>•</span>
              <span>{meal.protein}g protein</span>
            </div>
          )}
        </div>
      );
    }

    // Category Section Component
    function CategorySection({ categoryKey, category, selectedMeals, onToggleMeal, onSeeAll }) {
      return (
        <div className="mb-6">
          <div className="flex items-center justify-between px-5 mb-3">
            <h2 className="font-semibold text-gray-900">{category.name}</h2>
            <button onClick={onSeeAll} className="text-sage-500 text-sm font-medium">See All</button>
          </div>
          <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
            {category.meals.map(meal => (
              <MealCard
                key={meal.id}
                meal={meal}
                isSelected={!!selectedMeals[meal.id]}
                onToggle={() => onToggleMeal(meal, categoryKey)}
                showMacros={true}
              />
            ))}
          </div>
        </div>
      );
    }

    // Saved Plan Card Component
    function SavedPlanCard({ plan, onLoad }) {
      return (
        <button
          onClick={onLoad}
          className="flex-shrink-0 w-32 text-left"
        >
          <div className="relative">
            <div className="w-full h-24 rounded-2xl overflow-hidden bg-gray-100">
              {plan.meals.length > 0 ? (
                <div className="grid grid-cols-2 h-full">
                  {plan.meals.slice(0, 4).map((meal, i) => (
                    <img key={i} src={meal.thumb} alt="" className="w-full h-full object-cover" />
                  ))}
                </div>
              ) : (
                <div className="w-full h-full flex items-center justify-center text-gray-400">
                  <Icons.Utensils />
                </div>
              )}
            </div>
            <div className="absolute bottom-1 right-1 bg-white/90 backdrop-blur rounded-full px-2 py-0.5">
              <span className="text-xs font-medium text-gray-700">{plan.meals.length} meals</span>
            </div>
          </div>
          <p className="mt-2 text-sm font-medium text-gray-800 truncate">{plan.name}</p>
          <p className="text-xs text-gray-500">{plan.date}</p>
        </button>
      );
    }

    // Recipe Card with Macros (for plan detail view)
    function RecipeCardWithMacros({ meal, onRemove, servings, onServingsChange }) {
      return (
        <div className="bg-white rounded-2xl border border-gray-100 p-4 mb-3">
          <div className="flex gap-4">
            <div className="relative">
              <img src={meal.thumb} alt={meal.name} className="w-24 h-24 object-cover rounded-xl" />
              <button
                onClick={onRemove}
                className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-md text-xs"
              >
                <Icons.X />
              </button>
            </div>
            <div className="flex-1">
              <h3 className="font-semibold text-gray-900 mb-1">{meal.name}</h3>

              {/* Serving size control */}
              <div className="flex items-center gap-2 mb-3">
                <button
                  onClick={() => onServingsChange(Math.max(1, servings - 1))}
                  className="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-gray-500"
                >
                  <Icons.Minus />
                </button>
                <span className="text-sm font-medium">{servings} serving{servings > 1 ? 's' : ''}</span>
                <button
                  onClick={() => onServingsChange(servings + 1)}
                  className="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center text-gray-500"
                >
                  <Icons.Plus />
                </button>
              </div>

              {/* Recipe-level macros */}
              <div className="flex items-center gap-4 text-xs">
                <div className="text-center">
                  <span className="font-semibold text-gray-800">{meal.calories * servings}</span>
                  <span className="text-gray-500 ml-1">cal</span>
                </div>
                <div className="text-center">
                  <span className="font-semibold text-red-500">{meal.protein * servings}g</span>
                  <span className="text-gray-500 ml-1">protein</span>
                </div>
                <div className="text-center">
                  <span className="font-semibold text-amber-500">{meal.carbs * servings}g</span>
                  <span className="text-gray-500 ml-1">carbs</span>
                </div>
                <div className="text-center">
                  <span className="font-semibold text-blue-500">{meal.fat * servings}g</span>
                  <span className="text-gray-500 ml-1">fat</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Add Recipe Modal
    function AddRecipeModal({ onClose, onSave }) {
      const [name, setName] = useState('');
      const [calories, setCalories] = useState('');
      const [protein, setProtein] = useState('');
      const [carbs, setCarbs] = useState('');
      const [fat, setFat] = useState('');

      const handleSave = () => {
        if (!name.trim()) return;
        onSave({
          id: `custom-${Date.now()}`,
          name: name.trim(),
          calories: parseInt(calories) || 0,
          protein: parseInt(protein) || 0,
          carbs: parseInt(carbs) || 0,
          fat: parseInt(fat) || 0,
          prepTime: 0,
          thumb: 'https://images.unsplash.com/photo-1495521821757-a1efb6729352?w=300&q=80',
          isCustom: true,
          ingredients: [],
        });
        onClose();
      };

      return (
        <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50" onClick={onClose}>
          <div className="bg-white w-full max-w-md rounded-t-3xl p-6 slide-up" onClick={e => e.stopPropagation()}>
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-semibold text-gray-800">Add Your Recipe</h2>
              <button onClick={onClose} className="text-gray-400"><Icons.X /></button>
            </div>

            <div className="w-full h-32 bg-gray-100 rounded-2xl flex flex-col items-center justify-center mb-4 border-2 border-dashed border-gray-300">
              <Icons.Camera />
              <span className="text-sm text-gray-500 mt-2">Add photo (optional)</span>
            </div>

            <div className="space-y-4">
              <div>
                <label className="text-sm font-medium text-gray-700">Recipe Name *</label>
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  placeholder="e.g., Grandma's Chicken Soup"
                  className="w-full mt-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-sage-500"
                />
              </div>

              <div>
                <label className="text-sm font-medium text-gray-700 mb-2 block">Nutrition (optional)</label>
                <div className="grid grid-cols-4 gap-2">
                  <div>
                    <input type="number" value={calories} onChange={(e) => setCalories(e.target.value)} placeholder="0" className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500" />
                    <span className="text-xs text-gray-500 block text-center mt-1">Calories</span>
                  </div>
                  <div>
                    <input type="number" value={protein} onChange={(e) => setProtein(e.target.value)} placeholder="0" className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500" />
                    <span className="text-xs text-gray-500 block text-center mt-1">Protein</span>
                  </div>
                  <div>
                    <input type="number" value={carbs} onChange={(e) => setCarbs(e.target.value)} placeholder="0" className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500" />
                    <span className="text-xs text-gray-500 block text-center mt-1">Carbs</span>
                  </div>
                  <div>
                    <input type="number" value={fat} onChange={(e) => setFat(e.target.value)} placeholder="0" className="w-full px-3 py-2 border border-gray-200 rounded-lg text-center focus:outline-none focus:border-sage-500" />
                    <span className="text-xs text-gray-500 block text-center mt-1">Fat</span>
                  </div>
                </div>
              </div>
            </div>

            <div className="flex gap-3 mt-6">
              <button onClick={onClose} className="flex-1 py-3 border border-gray-200 text-gray-600 font-medium rounded-xl">Cancel</button>
              <button onClick={handleSave} disabled={!name.trim()} className="flex-1 py-3 bg-sage-500 text-white font-semibold rounded-xl disabled:opacity-50">Add Recipe</button>
            </div>
          </div>
        </div>
      );
    }

    // Shopping List View
    function ShoppingListView({ meals, planName, onBack }) {
      // Group ingredients by recipe
      const recipeIngredients = meals.map(meal => ({
        recipe: meal.name,
        servings: meal.servings || 1,
        ingredients: meal.ingredients || [],
        thumb: meal.thumb,
      }));

      // Count total items
      const totalItems = recipeIngredients.reduce((sum, r) => sum + r.ingredients.length, 0);

      return (
        <div className="min-h-screen bg-gray-50 max-w-md mx-auto pb-8">
          {/* Header */}
          <div className="sticky top-0 bg-white border-b border-gray-100 px-5 pt-14 pb-4 z-10">
            <div className="flex items-center gap-3">
              <button onClick={onBack} className="text-gray-600">
                <Icons.ChevronLeft />
              </button>
              <div>
                <h1 className="text-xl font-semibold text-gray-900">Shopping List</h1>
                <p className="text-sm text-gray-500">{planName} • {totalItems} items</p>
              </div>
            </div>
          </div>

          {/* Ingredients by Recipe */}
          <div className="px-5 py-4">
            {recipeIngredients.map((recipe, idx) => (
              <div key={idx} className="mb-6">
                {/* Recipe Header */}
                <div className="flex items-center gap-3 mb-3">
                  <img src={recipe.thumb} alt="" className="w-12 h-12 rounded-xl object-cover" />
                  <div>
                    <h3 className="font-semibold text-gray-900">{recipe.recipe}</h3>
                    <p className="text-xs text-gray-500">{recipe.servings} serving{recipe.servings > 1 ? 's' : ''} • {recipe.ingredients.length} items</p>
                  </div>
                </div>

                {/* Ingredients List */}
                <div className="bg-white rounded-2xl border border-gray-100 overflow-hidden">
                  {recipe.ingredients.length > 0 ? (
                    recipe.ingredients.map((ing, i) => (
                      <div key={i} className={`flex items-center justify-between px-4 py-3 ${i !== recipe.ingredients.length - 1 ? 'border-b border-gray-50' : ''}`}>
                        <div className="flex items-center gap-3">
                          <div className="w-5 h-5 rounded border-2 border-gray-300" />
                          <span className="text-gray-800">{ing.name}</span>
                        </div>
                        <span className="text-sm text-gray-500">{ing.amount}</span>
                      </div>
                    ))
                  ) : (
                    <div className="px-4 py-6 text-center text-gray-400">
                      <p>No ingredients listed</p>
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // Main App
    function App() {
      const [view, setView] = useState('main'); // 'main', 'category', 'plan', 'shopping'
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selectedMeals, setSelectedMeals] = useState({});
      const [customRecipes, setCustomRecipes] = useState([]);
      const [showAddRecipe, setShowAddRecipe] = useState(false);
      const [currentPlanName, setCurrentPlanName] = useState('');
      const [savedPlans, setSavedPlans] = useState([
        { id: 'sp1', name: 'Week 1 Meal Prep', date: 'Jan 26', meals: [
          { ...MEAL_DATA['high-protein'].meals[0], servings: 2 },
          { ...MEAL_DATA['low-calorie'].meals[0], servings: 1 },
          { ...MEAL_DATA['mediterranean'].meals[2], servings: 1 }
        ]},
        { id: 'sp2', name: 'Quick Weekday Meals', date: 'Jan 23', meals: [
          { ...MEAL_DATA['quick-easy'].meals[0], servings: 1 },
          { ...MEAL_DATA['quick-easy'].meals[1], servings: 1 }
        ]},
      ]);
      const [planName, setPlanName] = useState('');
      const [showSaveModal, setShowSaveModal] = useState(false);

      const toggleMeal = (meal, categoryKey) => {
        setSelectedMeals(prev => {
          if (prev[meal.id]) {
            const newMeals = { ...prev };
            delete newMeals[meal.id];
            return newMeals;
          } else {
            return { ...prev, [meal.id]: { ...meal, servings: 1, category: categoryKey } };
          }
        });
      };

      const updateServings = (mealId, servings) => {
        setSelectedMeals(prev => ({
          ...prev,
          [mealId]: { ...prev[mealId], servings }
        }));
      };

      const removeMeal = (mealId) => {
        setSelectedMeals(prev => {
          const newMeals = { ...prev };
          delete newMeals[mealId];
          return newMeals;
        });
      };

      const addCustomRecipe = (recipe) => {
        setCustomRecipes(prev => [recipe, ...prev]);
      };

      const savePlan = () => {
        if (!planName.trim()) return;
        const newPlan = {
          id: `plan-${Date.now()}`,
          name: planName,
          date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
          meals: Object.values(selectedMeals),
        };
        setSavedPlans(prev => [newPlan, ...prev]);
        setShowSaveModal(false);
        setPlanName('');
        setCurrentPlanName(planName);
      };

      const loadPlan = (plan) => {
        const mealsObj = {};
        plan.meals.forEach(meal => {
          mealsObj[meal.id] = { ...meal, servings: meal.servings || 1 };
        });
        setSelectedMeals(mealsObj);
        setCurrentPlanName(plan.name);
        setView('plan');
      };

      const selectedMealsArray = Object.values(selectedMeals);
      const totalMeals = selectedMealsArray.length;

      // Shopping List View
      if (view === 'shopping') {
        return (
          <ShoppingListView
            meals={selectedMealsArray}
            planName={currentPlanName || 'My Plan'}
            onBack={() => setView('plan')}
          />
        );
      }

      // Main Page
      if (view === 'main') {
        return (
          <div className={`min-h-screen bg-white max-w-md mx-auto ${totalMeals > 0 ? 'pb-28' : 'pb-8'}`}>
            {/* Header */}
            <div className="px-5 pt-14 pb-4 flex items-center justify-between">
              <h1 className="text-2xl font-bold text-gray-900">Meal Planning</h1>
              <button onClick={() => setShowAddRecipe(true)} className="text-sage-500 text-sm font-medium">+ Add Recipe</button>
            </div>

            {/* Recent Plans Section */}
            {savedPlans.length > 0 && (
              <div className="mb-6">
                <div className="flex items-center justify-between px-5 mb-3">
                  <h2 className="font-semibold text-gray-900">Recent</h2>
                  <button className="text-sage-500 text-sm font-medium">See All</button>
                </div>
                <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
                  {savedPlans.map(plan => (
                    <SavedPlanCard key={plan.id} plan={plan} onLoad={() => loadPlan(plan)} />
                  ))}
                </div>
              </div>
            )}

            {/* My Recipes Section */}
            {customRecipes.length > 0 && (
              <div className="mb-6">
                <div className="flex items-center justify-between px-5 mb-3">
                  <h2 className="font-semibold text-gray-900">My Recipes</h2>
                </div>
                <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
                  {customRecipes.map(meal => (
                    <MealCard key={meal.id} meal={meal} isSelected={!!selectedMeals[meal.id]} onToggle={() => toggleMeal(meal, 'custom')} showMacros={true} />
                  ))}
                </div>
              </div>
            )}

            {/* Most Popular Section */}
            <div className="mb-6">
              <div className="flex items-center justify-between px-5 mb-3">
                <h2 className="font-semibold text-gray-900">Most Popular</h2>
                <button className="text-sage-500 text-sm font-medium">See All</button>
              </div>
              <div className="flex gap-3 px-5 overflow-x-auto hide-scrollbar pb-2">
                {MOST_POPULAR.map(meal => (
                  <MealCard key={meal.id} meal={meal} isSelected={!!selectedMeals[meal.id]} onToggle={() => toggleMeal(meal, 'popular')} showMacros={true} />
                ))}
              </div>
            </div>

            {/* Category Sections */}
            {Object.entries(MEAL_DATA).map(([key, category]) => (
              <CategorySection
                key={key}
                categoryKey={key}
                category={category}
                selectedMeals={selectedMeals}
                onToggleMeal={toggleMeal}
                onSeeAll={() => { setSelectedCategory(key); setView('category'); }}
              />
            ))}

            {/* Floating Save Plan Bar */}
            {totalMeals > 0 && (
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 max-w-md mx-auto slide-up">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="flex -space-x-2">
                      {selectedMealsArray.slice(0, 3).map((meal, i) => (
                        <img key={i} src={meal.thumb} alt="" className="w-10 h-10 rounded-full object-cover border-2 border-white" />
                      ))}
                    </div>
                    <span className="text-sm text-gray-600">{totalMeals} meal{totalMeals > 1 ? 's' : ''} selected</span>
                  </div>
                  <button onClick={() => { setCurrentPlanName(''); setView('plan'); }} className="px-6 py-3 bg-sage-500 text-white font-semibold rounded-full">
                    Save plan
                  </button>
                </div>
              </div>
            )}

            {/* Add Recipe Modal */}
            {showAddRecipe && (
              <AddRecipeModal onClose={() => setShowAddRecipe(false)} onSave={addCustomRecipe} />
            )}
          </div>
        );
      }

      // See All Category View
      if (view === 'category' && selectedCategory) {
        const category = MEAL_DATA[selectedCategory];
        return (
          <div className="min-h-screen bg-white max-w-md mx-auto pb-32">
            <div className="sticky top-0 bg-white border-b border-gray-100 px-5 pt-14 pb-4 z-10">
              <div className="flex items-center gap-3">
                <button onClick={() => setView('main')} className="text-gray-600"><Icons.ChevronLeft /></button>
                <h1 className="text-xl font-semibold text-gray-900">{category.name}</h1>
              </div>
            </div>

            <div className="px-5 py-4">
              <div className="grid grid-cols-2 gap-4">
                {category.meals.map(meal => (
                  <MealCard key={meal.id} meal={meal} isSelected={!!selectedMeals[meal.id]} onToggle={() => toggleMeal(meal, selectedCategory)} showMacros={true} />
                ))}
              </div>
            </div>

            {totalMeals > 0 && (
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 max-w-md mx-auto">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="flex -space-x-2">
                      {selectedMealsArray.slice(0, 3).map((meal, i) => (
                        <img key={i} src={meal.thumb} alt="" className="w-10 h-10 rounded-full object-cover border-2 border-white" />
                      ))}
                    </div>
                    <span className="text-sm text-gray-600">{totalMeals} meal{totalMeals > 1 ? 's' : ''}</span>
                  </div>
                  <button onClick={() => { setCurrentPlanName(''); setView('plan'); }} className="px-6 py-3 bg-sage-500 text-white font-semibold rounded-full">Save plan</button>
                </div>
              </div>
            )}
          </div>
        );
      }

      // Plan Detail View
      if (view === 'plan') {
        return (
          <div className="min-h-screen bg-gray-50 max-w-md mx-auto pb-32">
            {/* Header with Plan Title */}
            <div className="sticky top-0 bg-white border-b border-gray-100 px-5 pt-14 pb-4 z-10">
              <div className="flex items-center gap-3">
                <button onClick={() => setView('main')} className="text-gray-600">
                  <Icons.ChevronLeft />
                </button>
                <div className="flex-1">
                  {currentPlanName ? (
                    <h1 className="text-xl font-semibold text-gray-900">{currentPlanName}</h1>
                  ) : (
                    <h1 className="text-xl font-semibold text-gray-900">New Plan</h1>
                  )}
                  <p className="text-sm text-gray-500">{totalMeals} meal{totalMeals > 1 ? 's' : ''}</p>
                </div>
              </div>
            </div>

            {/* Meals Section */}
            <div className="px-5 py-4">
              {/* Section Header with Edit Button */}
              <div className="flex items-center justify-between mb-4">
                <h2 className="font-semibold text-gray-900">Your Meals</h2>
                <button onClick={() => setView('main')} className="flex items-center gap-1 text-sage-500 text-sm font-medium">
                  <Icons.Edit />
                  <span>Add more / Edit</span>
                </button>
              </div>

              {totalMeals > 0 ? (
                selectedMealsArray.map(meal => (
                  <RecipeCardWithMacros
                    key={meal.id}
                    meal={meal}
                    servings={meal.servings}
                    onRemove={() => removeMeal(meal.id)}
                    onServingsChange={(s) => updateServings(meal.id, s)}
                  />
                ))
              ) : (
                <div className="bg-white rounded-2xl border border-gray-100 p-8 text-center">
                  <p className="text-gray-500 mb-3">No meals added yet</p>
                  <button onClick={() => setView('main')} className="px-4 py-2 bg-sage-500 text-white text-sm font-medium rounded-lg">
                    Browse Meals
                  </button>
                </div>
              )}
            </div>

            {/* Bottom Actions - 3 buttons */}
            {totalMeals > 0 && (
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 max-w-md mx-auto">
                <div className="flex gap-2">
                  <button
                    onClick={() => setShowSaveModal(true)}
                    className="flex-1 py-3 bg-sage-500 text-white font-semibold rounded-full flex items-center justify-center gap-2"
                  >
                    <Icons.Save />
                    <span>Save</span>
                  </button>
                  <button
                    className="flex-1 py-3 border border-gray-200 text-gray-700 font-medium rounded-full flex items-center justify-center gap-2"
                  >
                    <Icons.Share />
                    <span>Share</span>
                  </button>
                  <button
                    onClick={() => setView('shopping')}
                    className="flex-1 py-3 border border-gray-200 text-gray-700 font-medium rounded-full flex items-center justify-center gap-2"
                  >
                    <Icons.List />
                    <span>Shopping</span>
                  </button>
                </div>
              </div>
            )}

            {/* Save Modal */}
            {showSaveModal && (
              <div className="fixed inset-0 bg-black/50 flex items-end justify-center z-50" onClick={() => setShowSaveModal(false)}>
                <div className="bg-white w-full max-w-md rounded-t-3xl p-6 slide-up" onClick={e => e.stopPropagation()}>
                  <h2 className="text-xl font-semibold text-gray-800 mb-4">Save Your Plan</h2>
                  <input
                    type="text"
                    placeholder="Plan name (e.g., My Week Plan)"
                    value={planName}
                    onChange={(e) => setPlanName(e.target.value)}
                    className="w-full px-4 py-3 border border-gray-200 rounded-xl text-gray-800 mb-4 focus:outline-none focus:border-sage-500"
                  />
                  <div className="flex gap-3">
                    <button onClick={() => setShowSaveModal(false)} className="flex-1 py-3 border border-gray-200 text-gray-600 font-medium rounded-xl">Cancel</button>
                    <button onClick={savePlan} disabled={!planName.trim()} className="flex-1 py-3 bg-sage-500 text-white font-semibold rounded-xl disabled:opacity-50">Save</button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      return null;
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
